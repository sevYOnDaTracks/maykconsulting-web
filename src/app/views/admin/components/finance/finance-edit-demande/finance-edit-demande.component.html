<div class="dialog-scroll">
    <div class="shadow-sm p-4 bg-white rounded">
        <h5 class="mb-4 text-dark">{{ userData?.firstName }} {{ userData?.lastName }}</h5>
        <mat-divider class="mt-2 mb-2"></mat-divider>
        <form *ngIf="financeData; else loadingFinance">
            <!-- Country and City -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="country" class="form-label">Pays</label>
                        <input type="text" id="country" class="form-control" [(ngModel)]="financeData.country" name="country">
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label for="city" class="form-label">Ville</label>
                        <input type="text" id="city" class="form-control" [(ngModel)]="financeData.city" name="city">
                    </div>
                </div>
            </div>

            <!-- Etat de la demande -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="form-group">
                        <label for="etatDemande" class="form-label">État de la demande</label>
                        <select id="etatDemande" class="form-select" [(ngModel)]="financeData.etatDemande" name="etatDemande">
                            <option [value]="0">En attente</option>
                            <option [value]="1">En cours</option>
                            <option [value]="2">Traitement terminée</option>
                            <option [value]="3">Archivée</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Argent retirée -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="form-group">
                        <label for="payout" class="form-label">Argent retiré ?</label>
                        <select id="payout" class="form-select" [(ngModel)]="financeData.payout" name="payout">
                            <option value="0">Non</option>
                            <option value="1">Oui</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Etat du visa -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="form-group">
                        <label for="visa" class="form-label">Visa obtenu ?</label>
                        <select id="visa" class="form-select" [(ngModel)]="financeData.visa" name="visa">
                            <option value="0">Non</option>
                            <option value="1">Oui</option>
                        </select>
                    </div>
                </div>
            </div>



            <!-- Informations de paiement -->
            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="paiementService" class="form-label">Service de paiement</label>
                        <select id="paiementService" class="form-select" [(ngModel)]="financeData.paiementService" name="paiementService">
                            <option value="">Sélectionner</option>
                            <option>Western Union</option>
                            <option>Ria</option>
                            <option>MoneyGram</option>
                            <option>Autres</option>
                        </select>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="paiementCode" class="form-label">N° de retrait</label>
                        <input type="text" id="paiementCode" class="form-control" [(ngModel)]="financeData.paiementCode" name="paiementCode" placeholder="Code / Référence">
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="form-group">
                        <label for="paiementMontant" class="form-label">Montant payé</label>
                        <input type="number" min="0" step="0.01" id="paiementMontant" class="form-control" [(ngModel)]="financeData.paiementMontant" name="paiementMontant" placeholder="Ex: 400000">
                    </div>
                </div>
            </div>

            <!-- Files Section -->
            <div class="row mb-2">
                <div class="form-group col-md-6">
                    <label class="form-label">Passeport</label>
                    <div class="row"><div class="col-md-5"> <button matTooltip="Télecharger" (click)="viewDocument(financeData.passport)"  target="_blank" class="btn btn-sm mb-2" style="background: #1e3c72; color: white; width: 100%">
                        <i class="fas fa-download fa-sm text-white"></i>
                    </button></div>
                        <div class="col-md-5"><button matTooltip="retirer" (click)="deleteDocument('passport')"   target="_blank" class="btn btn-sm mb-2" style="background: #d9006e; color: white; width: 100%">
                            <i class="fas fa-trash fa-sm text-white"></i>
                        </button></div></div>

                </div>
                <div class="form-group col-md-6">
                    <label class="form-label">Preuve d'admission</label>
                    <div class="row">
                        <div class="col-md-5">
                            <button matTooltip="Télecharger" (click)="viewDocument(financeData.admissionFile)"  target="_blank" class="btn btn-sm d-block mb-2" style="background: #1e3c72; color: white;width: 100%">
                                <i class="fas fa-download fa-sm text-white"></i>
                            </button>
                        </div>
                        <div class="col-md-5">
                            <button matTooltip="retirer" (click)="deleteDocument('admissionFile')"  target="_blank" class="btn btn-sm d-block mb-2" style="background: #d9006e; color: white;width: 100%">
                                <i class="fas fa-trash fa-sm text-white"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mb-4">
                <div class="form-group col-md-6">
                    <label class="form-label">Justificatif de paiement</label>
                    <div *ngIf="!financeData.justificatifPaiement" class="text-warning mb-2">Aucun justificatif de paiement.</div>
                    <div *ngIf="financeData.justificatifPaiement">
                        <div class="row">
                            <div class="col-md-5">
                                <button matTooltip="Télécharger" (click)="viewDocument(financeData.justificatifPaiement)" target="_blank" class="btn btn-sm d-block mb-2" style="background: #1e3c72; color: white;width: 100%">
                                    <i class="fas fa-download fa-sm text-white"></i>
                                </button></div>
                            <div class="col-md-5"><button matTooltip="retirer" (click)="deleteDocument('justificatifPaiement')"   target="_blank" class="btn btn-sm d-block mb-2" style="background: #d9006e; color: white;width: 100%">
                                <i class="fas fa-trash fa-sm text-white"></i>
                            </button></div>

                        </div>

                    </div>
                    <ng-container *ngIf="!financeData.justificatifPaiement">
                        <input type="file" (change)="onPaymentFileSelected($event)" hidden #paymentFileInput accept="image/*,application/pdf">
                        <button class="btn btn-sm d-block" style="background: #1e3c72; color: white; width: 100%" mat-flat-button (click)="paymentFileInput.click()">
                            <mat-icon>cloud_upload</mat-icon>
                        </button>
                    </ng-container>

                </div>
                <div class="form-group col-md-12">
                    <label for="etatDemande" class="form-label">Finance Doc :</label>
                    <div *ngIf="!financeData.garantFile">
                        <input type="file" (change)="onFileSelected($event)" hidden #fileInput accept="image/*,application/pdf">
                        <button class="btn btn-sm" style="background: #1e3c72; color: white; width: 100%" mat-flat-button (click)="fileInput.click()">
                            <mat-icon>cloud_upload</mat-icon>
                        </button>
                    </div>
                    <div *ngIf="financeData.garantFile">
                        <div class="row">
                            <div class="col-md-5">
                                <button (click)="viewDocument(financeData.garantFile)" matTooltip="Télecharger" target="_blank" class="btn btn-sm d-block mb-2" style="background: #1e3c72; color: white;width: 100%">
                                    <i class="fas fa-download fa-sm text-white"></i>
                                </button></div>
                            <div class="col-md-5"><button (click)="deleteDocument('garantFile')" matTooltip="retirer"  target="_blank" class="btn btn-sm d-block mb-2" style="background: #d9006e; color: white;width: 100%">
                                <i class="fas fa-trash fa-sm text-white"></i>
                            </button></div>
                        </div>
                    </div>
                </div>
            </div>



            <!-- Submit Button -->
            <div class="text-end">
                <button type="button" class="btn px-4" style="background: #d9006e; color: white; margin-right: 10px" mat-dialog-close>Annuler</button>
                <button type="button" class="btn px-4" (click)="updateFinance()" style="background: #1e3c72; color: white" mat-dialog-close>Mettre à jour</button>
            </div>
        </form>
    </div>
</div>

<div *ngIf="isSubmitting" class="overlay">
    <mat-spinner diameter="50"></mat-spinner>
</div>

<ng-template #loadingFinance>
    <div class="text-center p-4">
        <mat-spinner diameter="40"></mat-spinner>
    </div>
</ng-template>

<style>
    .overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(197, 197, 197, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
    }
</style>
