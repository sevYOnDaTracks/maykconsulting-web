<div class="payment-page">
  <div class="header">
    <button mat-stroked-button color="primary" [routerLink]="returnRoute">
      <mat-icon>arrow_back</mat-icon>
      Retour
    </button>
    <h1>Justificatif de paiement - {{ selectedModule | titlecase }}</h1>
  </div>

  <form [formGroup]="paymentForm" class="form-card mat-elevation-z2">
    <div class="form-grid">
      <mat-form-field appearance="outline">
        <mat-label>Service demandé</mat-label>
        <mat-select formControlName="module">
          <mat-option value="admission">Admission</mat-option>
          <mat-option value="hebergement">Hébergement</mat-option>
          <mat-option value="finance">Garant financier</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Service de paiement</mat-label>
        <mat-select formControlName="servicePaiement">
          <mat-option value="Western Union">Western Union</mat-option>
          <mat-option value="Ria">Ria</mat-option>
          <mat-option value="MoneyGram">MoneyGram</mat-option>
          <mat-option [value]="otherServiceLabel">Autres</mat-option>
        </mat-select>
      </mat-form-field>

      <ng-container *ngIf="!isOtherServiceSelected(paymentForm.value.servicePaiement); else noCodeNeeded">
        <mat-form-field appearance="outline">
          <mat-label>Code de retrait</mat-label>
          <input matInput formControlName="codeRetrait" placeholder="XXXX XXX XXX">
        </mat-form-field>
      </ng-container>
      <ng-template #noCodeNeeded>
        <div class="mat-body-2" style="align-self: center;">Pas de code requis pour ce service.</div>
      </ng-template>

      <mat-form-field appearance="outline">
        <mat-label>Montant en (€)</mat-label>
        <input matInput type="number" step="0.01" inputmode="decimal" formControlName="montantPaiement" min="1" placeholder="Ex: 250">
      </mat-form-field>
    </div>

    <div class="upload-block mat-elevation-z1">
      <div *ngIf="existingFileUrl" class="current-file">
        <mat-icon color="primary">attach_file</mat-icon>
        <span>Justificatif actuel</span>
        <button mat-button color="primary" (click)="openExistingFile()">
          <mat-icon>visibility</mat-icon> Voir
        </button>
      </div>
      <input type="file" (change)="onFileSelected($event)" hidden #fileInput accept="image/*,application/pdf">
      <button mat-stroked-button color="primary" (click)="fileInput.click()">
        <mat-icon>cloud_upload</mat-icon> Justificatif
      </button>
      <p class="muted">Image ou PDF · max 8 Mo</p>

      <div *ngIf="file || filePreview" class="preview">
        <img *ngIf="filePreview" [src]="filePreview" alt="Justificatif">
        <div *ngIf="!filePreview && file" class="pdf-box">
          <img src="assets/images/pdf.png" alt="PDF">
          <span>PDF sélectionné</span>
        </div>
        <button mat-button color="accent" (click)="removeFile()">
          <mat-icon>delete</mat-icon> Retirer
        </button>
      </div>
    </div>

    <div class="actions">
      <button mat-flat-button color="primary" (click)="submit()" [disabled]="isSubmitting">
        Soumettre
      </button>
    </div>
  </form>
</div>
